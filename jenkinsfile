//Nota: hay dos archivos docker compose, 
//uno compila apk con variables de entorno y el otro no.

pipeline {
    agent any
    stages {
        stage("Build Development"){
            when {
                expression {
                    return env.GIT_BRANCH =='staging'
                }
            }
            steps{
                sh "docker-compose -f docker-compose.dev.yml up --build"
            }
        }
        stage('Deploy Development'){
            when {
                expression {
                    return env.GIT_BRANCH == 'staging'
                }
            }
            environment {
                APK_VERSION = sh(
                    returnStdout: true, 
                    script: "echo \$(grep 'version:' pubspec.yaml | awk '{print \$2}')"
                ).trim()
            }
            steps{
                sh 'scp ./wms_development_apk/app-armeabi-v7a-release.apk wms1_windows:\\\\Handheld\\\\cicd\\\\development'
            }
        }
        /* stage("Build Production"){
            when {
                expression {
                    return env.GIT_BRANCH =='main'
                }
            }
            steps{
                sh 'cp /var/lib/jenkins/Environment/WMS_Mobile .env'
                sh "docker-compose up --build"
            }
        }
        stage('Deploy Production'){
            when {
                expression {
                    return env.GIT_BRANCH == 'main'
                }
            }
            environment {
                APK_VERSION = sh(
                    returnStdout: true, 
                    script: "echo \$(grep 'version:' pubspec.yaml | awk '{print \$2}')"
                ).trim()
            }
            steps{
                sh 'scp ./apks/app-armeabi-v7a-release.apk wms1_windows:\\\\Handheld\\\\cicd\\\\production'
            }
        } */
    }
}  