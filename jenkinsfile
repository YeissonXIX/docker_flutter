pipeline {
    agent any
    stages {
        stage("Build"){
            steps{
                //Habilitar variables de entorno
                sh "cp /var/lib/jenkins/Environment/WMS_Mobile .env"
                sh "docker-compose up --build"
            }
        }
        stage('Deploy'){
            environment {
                APK_VERSION = sh(
                    returnStdout: true, 
                    script: "echo \$(grep 'version:' pubspec.yaml | awk '{print \$2}')"
                )
            }
            steps{
                //Cambiar el nombre del apk a su version actual
                sh "mv ./apks/app-armeabi-v7a-release.apk ${APK_VERSION}.apk"
                //Enviar al servidor ftp
                sh "scp ./apks/${APK_VERSION}.apk wms1_windows:\\\\Handheld\\\\cicd_test"
                
            }
        }
    }
}  